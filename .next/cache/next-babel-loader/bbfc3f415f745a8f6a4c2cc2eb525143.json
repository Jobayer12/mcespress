{"ast":null,"code":"import Router from \"next/router\";\nimport axios from \"axios\";\nconst WINDOW_USER_SCRIPT_VARIABLE = \"__USER__\";\nexport const getUserScript = user => {\n  return `${WINDOW_USER_SCRIPT_VARIABLE} = ${JSON.stringify(user)};`;\n};\nexport const getSessionFromServer = req => {\n  if (req.user) {\n    return {\n      user: req.user\n    };\n  }\n\n  return {};\n};\nexport const getSessionFromClient = () => {\n  if (false) {\n    const user = window[WINDOW_USER_SCRIPT_VARIABLE] || {};\n    return {\n      user\n    };\n  }\n\n  return {\n    user: {}\n  };\n};\n\nconst redirectUser = (res, path) => {\n  if (res) {\n    res.redirect(302, path);\n    res.finished = true;\n    return {};\n  }\n\n  Router.replace(path);\n  return {};\n};\n\nexport const authInitialProps = isProtectedRoute => ({\n  req,\n  res,\n  query: {\n    userId\n  }\n}) => {\n  const auth = req ? getSessionFromServer(req) : getSessionFromClient();\n  const currentPath = req ? req.url : window.location.pathname;\n  const user = auth.user;\n  const isAnonymous = !user;\n\n  if (isProtectedRoute && isAnonymous && currentPath !== \"/signin\") {\n    return redirectUser(res, \"/signin\");\n  }\n\n  return {\n    auth,\n    userId\n  };\n};\nexport const signupUser = async user => {\n  const {\n    data\n  } = await axios.post(\"/api/auth/signup\", user);\n  return data;\n};\nexport const signinuser = async user => {\n  const {\n    data\n  } = await axios.post(\"/api/auth/signin\", user);\n\n  if (false) {\n    window[WINDOW_USER_SCRIPT_VARIABLE] = data || {};\n  } // return data;\n\n};\nexport const signoutUser = async () => {\n  if (false) {\n    window[WINDOW_USER_SCRIPT_VARIABLE] = {};\n  }\n\n  await axios.get(\"/api/auth/signout\");\n  Router.push(\"/signin\");\n};","map":{"version":3,"sources":["D:/mecspress/lib/auth.js"],"names":["Router","axios","WINDOW_USER_SCRIPT_VARIABLE","getUserScript","user","JSON","stringify","getSessionFromServer","req","getSessionFromClient","window","redirectUser","res","path","redirect","finished","replace","authInitialProps","isProtectedRoute","query","userId","auth","currentPath","url","location","pathname","isAnonymous","signupUser","data","post","signinuser","signoutUser","get","push"],"mappings":"AAAA,OAAOA,MAAP,MAAmB,aAAnB;AACA,OAAOC,KAAP,MAAkB,OAAlB;AAEA,MAAMC,2BAA2B,GAAG,UAApC;AAEA,OAAO,MAAMC,aAAa,GAAGC,IAAI,IAAI;AACnC,SAAQ,GAAEF,2BAA4B,MAAKG,IAAI,CAACC,SAAL,CAAeF,IAAf,CAAqB,GAAhE;AACD,CAFM;AAIP,OAAO,MAAMG,oBAAoB,GAAGC,GAAG,IAAI;AACzC,MAAIA,GAAG,CAACJ,IAAR,EAAc;AACZ,WAAO;AAAEA,MAAAA,IAAI,EAAEI,GAAG,CAACJ;AAAZ,KAAP;AACD;;AACD,SAAO,EAAP;AACD,CALM;AAOP,OAAO,MAAMK,oBAAoB,GAAG,MAAM;AACxC,aAAmC;AACjC,UAAML,IAAI,GAAGM,MAAM,CAACR,2BAAD,CAAN,IAAuC,EAApD;AACA,WAAO;AAAEE,MAAAA;AAAF,KAAP;AACD;;AACD,SAAO;AAAEA,IAAAA,IAAI,EAAE;AAAR,GAAP;AACD,CANM;;AAQP,MAAMO,YAAY,GAAG,CAACC,GAAD,EAAMC,IAAN,KAAe;AAClC,MAAID,GAAJ,EAAS;AACPA,IAAAA,GAAG,CAACE,QAAJ,CAAa,GAAb,EAAkBD,IAAlB;AACAD,IAAAA,GAAG,CAACG,QAAJ,GAAe,IAAf;AACA,WAAO,EAAP;AACD;;AACDf,EAAAA,MAAM,CAACgB,OAAP,CAAeH,IAAf;AACA,SAAO,EAAP;AACD,CARD;;AAUA,OAAO,MAAMI,gBAAgB,GAAGC,gBAAgB,IAAI,CAAC;AACnDV,EAAAA,GADmD;AAEnDI,EAAAA,GAFmD;AAGnDO,EAAAA,KAAK,EAAE;AAAEC,IAAAA;AAAF;AAH4C,CAAD,KAI9C;AACJ,QAAMC,IAAI,GAAGb,GAAG,GAAGD,oBAAoB,CAACC,GAAD,CAAvB,GAA+BC,oBAAoB,EAAnE;AACA,QAAMa,WAAW,GAAGd,GAAG,GAAGA,GAAG,CAACe,GAAP,GAAab,MAAM,CAACc,QAAP,CAAgBC,QAApD;AACA,QAAMrB,IAAI,GAAGiB,IAAI,CAACjB,IAAlB;AACA,QAAMsB,WAAW,GAAG,CAACtB,IAArB;;AACA,MAAIc,gBAAgB,IAAIQ,WAApB,IAAmCJ,WAAW,KAAK,SAAvD,EAAkE;AAChE,WAAOX,YAAY,CAACC,GAAD,EAAM,SAAN,CAAnB;AACD;;AACD,SAAO;AAAES,IAAAA,IAAF;AAAQD,IAAAA;AAAR,GAAP;AACD,CAbM;AAeP,OAAO,MAAMO,UAAU,GAAG,MAAMvB,IAAN,IAAc;AACtC,QAAM;AAAEwB,IAAAA;AAAF,MAAW,MAAM3B,KAAK,CAAC4B,IAAN,CAAW,kBAAX,EAA+BzB,IAA/B,CAAvB;AAEA,SAAOwB,IAAP;AACD,CAJM;AAMP,OAAO,MAAME,UAAU,GAAG,MAAM1B,IAAN,IAAc;AACtC,QAAM;AAAEwB,IAAAA;AAAF,MAAW,MAAM3B,KAAK,CAAC4B,IAAN,CAAW,kBAAX,EAA+BzB,IAA/B,CAAvB;;AACA,aAAmC;AACjCM,IAAAA,MAAM,CAACR,2BAAD,CAAN,GAAsC0B,IAAI,IAAI,EAA9C;AACD,GAJqC,CAKtC;;AACD,CANM;AAQP,OAAO,MAAMG,WAAW,GAAG,YAAY;AACrC,aAAmC;AACjCrB,IAAAA,MAAM,CAACR,2BAAD,CAAN,GAAsC,EAAtC;AACD;;AACD,QAAMD,KAAK,CAAC+B,GAAN,CAAU,mBAAV,CAAN;AACAhC,EAAAA,MAAM,CAACiC,IAAP,CAAY,SAAZ;AACD,CANM","sourcesContent":["import Router from \"next/router\";\r\nimport axios from \"axios\";\r\n\r\nconst WINDOW_USER_SCRIPT_VARIABLE = \"__USER__\";\r\n\r\nexport const getUserScript = user => {\r\n  return `${WINDOW_USER_SCRIPT_VARIABLE} = ${JSON.stringify(user)};`;\r\n};\r\n\r\nexport const getSessionFromServer = req => {\r\n  if (req.user) {\r\n    return { user: req.user };\r\n  }\r\n  return {};\r\n};\r\n\r\nexport const getSessionFromClient = () => {\r\n  if (typeof window !== \"undefined\") {\r\n    const user = window[WINDOW_USER_SCRIPT_VARIABLE] || {};\r\n    return { user };\r\n  }\r\n  return { user: {} };\r\n};\r\n\r\nconst redirectUser = (res, path) => {\r\n  if (res) {\r\n    res.redirect(302, path);\r\n    res.finished = true;\r\n    return {};\r\n  }\r\n  Router.replace(path);\r\n  return {};\r\n};\r\n\r\nexport const authInitialProps = isProtectedRoute => ({\r\n  req,\r\n  res,\r\n  query: { userId }\r\n}) => {\r\n  const auth = req ? getSessionFromServer(req) : getSessionFromClient();\r\n  const currentPath = req ? req.url : window.location.pathname;\r\n  const user = auth.user;\r\n  const isAnonymous = !user;\r\n  if (isProtectedRoute && isAnonymous && currentPath !== \"/signin\") {\r\n    return redirectUser(res, \"/signin\");\r\n  }\r\n  return { auth, userId };\r\n};\r\n\r\nexport const signupUser = async user => {\r\n  const { data } = await axios.post(\"/api/auth/signup\", user);\r\n\r\n  return data;\r\n};\r\n\r\nexport const signinuser = async user => {\r\n  const { data } = await axios.post(\"/api/auth/signin\", user);\r\n  if (typeof window !== \"undefined\") {\r\n    window[WINDOW_USER_SCRIPT_VARIABLE] = data || {};\r\n  }\r\n  // return data;\r\n};\r\n\r\nexport const signoutUser = async () => {\r\n  if (typeof window !== \"undefined\") {\r\n    window[WINDOW_USER_SCRIPT_VARIABLE] = {};\r\n  }\r\n  await axios.get(\"/api/auth/signout\");\r\n  Router.push(\"/signin\");\r\n};\r\n"]},"metadata":{},"sourceType":"module"}